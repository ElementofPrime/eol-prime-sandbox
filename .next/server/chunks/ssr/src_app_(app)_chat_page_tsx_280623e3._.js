module.exports=[56095,a=>{"use strict";var b=a.i(87924);let c=function(){for(var a,b,c=0,d="",e=arguments.length;c<e;c++)(a=arguments[c])&&(b=function a(b){var c,d,e="";if("string"==typeof b||"number"==typeof b)e+=b;else if("object"==typeof b)if(Array.isArray(b)){var f=b.length;for(c=0;c<f;c++)b[c]&&(d=a(b[c]))&&(e&&(e+=" "),e+=d)}else for(d in b)b[d]&&(e&&(e+=" "),e+=d);return e}(a))&&(d&&(d+=" "),d+=b);return d};var d=a.i(72131),e=a.i(75003),f=a.i(71987);function g(){let a=!function(a=768){let[b,c]=(0,d.useState)(!1);return(0,d.useEffect)(()=>{},[a]),b}(768)?"/assets/fortress-bg-desktop.webp":"/assets/fortress-bg-portrait.webp",[c,e]=(0,d.useState)(!0);return(0,d.useEffect)(()=>{},[a]),(0,b.jsxs)("div",{"aria-hidden":!0,className:"pointer-events-none fixed inset-0 -z-10 overflow-hidden",children:[(0,b.jsx)("div",{className:"absolute inset-0 bg-[radial-gradient(60%_60%_at_50%_20%,#87a7c766_0%,#0b122099_60%,transparent_100%)]"}),(0,b.jsx)("div",{className:"absolute inset-0 opacity-30 bg-[url('/assets/starfield.png')] bg-repeat"}),c&&(0,b.jsxs)("div",{className:"absolute inset-0",children:[(0,b.jsx)(f.default,{src:a,alt:"",fill:!0,priority:!0,className:"object-cover opacity-90 select-none",sizes:"100vw"}),(0,b.jsx)("div",{className:"absolute inset-0 bg-linear-to-t from-slate-900/80 via-transparent to-transparent"})]})]})}function h({tone:a="neutral"}){let c=(0,d.useMemo)(()=>{switch(a){case"calm":return"from-cyan-300/25 via-cyan-500/15 to-transparent";case"excited":return"from-amber-300/25 via-amber-500/15 to-transparent";case"reflective":return"from-sky-300/25 via-blue-400/15 to-transparent";case"stressed":return"from-violet-400/25 via-fuchsia-500/10 to-transparent";default:return"from-slate-300/20 via-slate-500/10 to-transparent"}},[a]);return(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("div",{className:`pointer-events-none absolute -inset-6 rounded-3xl bg-linear-to-br ${c}`,"aria-hidden":"true"}),(0,b.jsx)("div",{className:"relative"})]})}function i(){let{status:a}=(0,e.useSession)(),f="authenticated"===a,[i,j]=(0,d.useState)([]),[k,l]=(0,d.useState)(""),[m,n]=(0,d.useState)(!1),[o,p]=(0,d.useState)("neutral"),[q,r]=(0,d.useState)(null),s=(0,d.useRef)(null),t=(0,d.useRef)(null);async function u(a){try{let b=await fetch("/api/pulse",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:a})});if(!b.ok)return p("neutral");let c=await b.json();c?.tone&&p(c.tone)}catch{p("neutral")}}async function v(){let a=k.trim();if(!a||m)return;if(a.length>2e3)return void r("Message is too long (max 2000 characters).");let b=i.filter(a=>"user"===a.role).length;if(!f&&b>=5)return void j(a=>[...a,{role:"assistant",content:"Limit reached (5 chats). Create an account or sign in to unlock full access, memory, and the full Fortress experience."}]);t.current?.abort();let c=new AbortController;t.current=c;let d={role:"user",content:a};j(a=>[...a,d,{role:"assistant",content:""}]),l(""),r(null),n(!0),u(a);try{let a=await fetch("/api/prime",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:[...i,d]}),signal:c.signal});if(!a.ok||!a.body)throw Error(`Prime endpoint ${a.status}`);let b=a.body.getReader(),e=new TextDecoder,f="",g=0,h=async()=>{try{for(;;){let{value:a,done:c}=await b.read();if(c)break;f+=e.decode(a,{stream:!0}),g||(g=requestAnimationFrame(()=>{j(a=>{let b=[...a],c=b.length-1;return c>=0&&"assistant"===b[c].role&&(b[c]={role:"assistant",content:f}),b}),g=0}))}}finally{g&&cancelAnimationFrame(g)}};await h(),j(a=>{let b=[...a],c=b.length-1;return c>=0&&"assistant"===b[c].role&&(b[c]={role:"assistant",content:f||"…"}),b}),u(f)}catch(a){if(a?.name==="AbortError")return;j(a=>[...a.slice(0,-1),{role:"assistant",content:"I hit a snag reaching the Prime endpoint. Try again in a moment, or check your connection."}]),r(a?.message??"Request failed.")}finally{n(!1),t.current=null}}(0,d.useEffect)(()=>{0===i.length&&j([{role:"assistant",content:"Welcome to the Fortress of Prime — a calm, sovereign space for clarity and growth. When you're ready, share what’s on your mind and I’ll meet you there."}])},[i.length]),(0,d.useEffect)(()=>{let a=s.current;if(!a)return;let b=requestAnimationFrame(()=>a.scrollTo({top:a.scrollHeight,behavior:"smooth"}));return()=>cancelAnimationFrame(b)},[i,m]);let w=!f&&i.filter(a=>"user"===a.role).length>=5;return(0,b.jsxs)("main",{className:"relative min-h-svh pt-24 md:pt-28 bg-slate-50 dark:bg-slate-950",children:[(0,b.jsx)(g,{}),"authenticated"!==a&&(0,b.jsx)("div",{className:"mx-auto w-full max-w-3xl px-4",children:(0,b.jsxs)("div",{className:"rounded-2xl border border-slate-200 dark:border-slate-800 bg-white/80 dark:bg-black/80 backdrop-blur p-4 text-sm text-slate-700 dark:text-slate-300",children:[(0,b.jsx)("span",{className:"mr-2",children:"Warning"}),"Limited to ",(0,b.jsx)("strong",{children:"5 chats"}),"."," ",(0,b.jsx)("span",{className:"opacity-90",children:"Create an account or sign in to access full features."}),(0,b.jsx)("button",{onClick:()=>(0,e.signIn)(),className:"ml-3 rounded-lg bg-cyan-600 px-3 py-1 text-white hover:bg-cyan-500",children:"Sign in"})]})}),!f&&i.length>0&&!w&&(0,b.jsx)("div",{className:"mx-auto max-w-3xl px-4 mb-4",children:(0,b.jsxs)("div",{className:"rounded-xl border border-cyan-500/30 bg-cyan-500/10 p-4 text-center",children:[(0,b.jsxs)("p",{className:"text-cyan-900 dark:text-cyan-200 text-sm",children:["Sign in to ",(0,b.jsx)("strong",{children:"save this conversation"})," and continue with Prime anytime."]}),(0,b.jsx)("button",{onClick:()=>(0,e.signIn)(),className:"mt-2 text-xs underline text-cyan-700 dark:text-cyan-300 hover:text-cyan-900",children:"Sign in now"})]})}),f&&i.length>0&&(0,b.jsx)("div",{className:"mx-auto max-w-3xl px-4 mb-4",children:(0,b.jsxs)("div",{className:"flex items-center justify-center gap-2 text-emerald-600 dark:text-emerald-400 text-sm font-medium",children:[(0,b.jsx)("span",{className:"w-2 h-2 bg-emerald-500 rounded-full animate-pulse"}),"Prime remembers you. The light within your Tree is glowing brighter every day."]})}),(0,b.jsxs)("div",{ref:s,className:"mx-auto h-[calc(100svh-220px)] w-full max-w-3xl overflow-y-auto px-4 pb-40 md:pb-48 scrollbar-thin",children:[(0,b.jsx)("div",{className:"mb-6 text-center text-[11px] tracking-widest text-slate-700 dark:text-slate-200/70 uppercase",children:"Within these walls — Truth & Light always win."}),(0,b.jsx)("div",{className:"space-y-3",children:i.map((a,d)=>{let e="user"===a.role,f="assistant"===a.role;return(0,b.jsxs)("div",{className:c("max-w-xs rounded-2xl px-4 py-3 border",e?"mr-auto bg-slate-100 dark:bg-slate-800 text-slate-900 dark:text-slate-100 border-slate-200 dark:border-slate-700":"ml-auto bg-cyan-500/20 dark:bg-cyan-600/20 text-cyan-700 dark:text-cyan-300 border-cyan-500/30 dark:border-cyan-600/30"),"aria-live":d===i.length-1&&f?"polite":void 0,children:[(0,b.jsx)(h,{tone:o}),(0,b.jsx)("div",{className:"relative whitespace-pre-wrap",children:a.content})]},d)})}),m&&(0,b.jsx)("div",{className:"mr-auto max-w-[85%] rounded-2xl border border-slate-200 dark:border-slate-800 bg-white/60 dark:bg-black/60 px-5 py-3 text-slate-600 dark:text-slate-400 backdrop-blur animate-pulse",children:"Prime is focusing…"}),q&&!m&&(0,b.jsx)("div",{className:"mr-auto max-w-[85%] rounded-2xl border border-rose-400/30 bg-rose-500/10 px-5 py-3 text-sm text-rose-700 dark:text-rose-300",children:q}),w&&(0,b.jsx)("div",{className:"mx-auto max-w-3xl px-4 mb-6",children:(0,b.jsxs)("div",{className:"rounded-2xl border border-amber-500/30 bg-linear-to-r from-amber-500/10 to-orange-500/10 p-5 text-center",children:[(0,b.jsx)("p",{className:"text-amber-900 dark:text-amber-200 font-semibold mb-3",children:"You've reached the guest limit (5 messages)."}),(0,b.jsxs)("p",{className:"text-sm text-amber-800 dark:text-amber-300 mb-4",children:["Unlock"," ",(0,b.jsx)("strong",{children:"unlimited chat, memory, and your Tree of Life"})," ","with SuperGrok."]}),(0,b.jsx)("button",{onClick:()=>(0,e.signIn)(),className:"rounded-xl bg-linear-to-r from-emerald-600 to-cyan-600 px-6 py-3 text-white font-bold hover:from-emerald-700 hover:to-cyan-700 transition-all shadow-lg",children:"Upgrade Now — $9/mo"})]})})]}),(0,b.jsx)("div",{className:"fixed inset-x-0 bottom-0 z-10",children:(0,b.jsxs)("div",{className:"mx-auto w-full max-w-3xl px-4 pb-5",children:[(0,b.jsxs)("div",{className:"relative rounded-2xl border border-slate-200 dark:border-slate-800 bg-white/80 dark:bg-black/80 backdrop-blur p-3",children:[(0,b.jsx)(h,{tone:o}),(0,b.jsx)("textarea",{value:k,onChange:a=>l(a.target.value),onKeyDown:a=>{"Enter"!==a.key||a.shiftKey||(a.preventDefault(),v())},placeholder:"Speak to Prime within the safety of the Fortress…",className:"min-h-[60px] w-full resize-none rounded-xl bg-white/70 dark:bg-black/70 p-3 text-slate-900 dark:text-slate-100 placeholder:text-slate-500 dark:placeholder:text-slate-400 focus:outline-none focus-visible:outline-2 focus-visible:outline-cyan-500 focus-visible:outline-offset-2"}),(0,b.jsx)("div",{className:"mt-2 flex items-center justify-end gap-2",children:(0,b.jsx)("button",{onClick:v,disabled:m||w,className:"rounded-xl bg-cyan-600 dark:bg-cyan-700 px-5 py-2 text-sm font-medium text-white hover:bg-cyan-500 dark:hover:bg-cyan-600 transition-all",children:m?"Sending…":"Send to Prime"})})]}),(0,b.jsx)("div",{className:"mt-3 text-center text-[11px] text-slate-700 dark:text-slate-200/70",children:"“Prime is here to help you navigate safely. The world is full of deception and deepfakes — we don’t fall for any of it.”"})]})})]})}a.s(["default",()=>i],56095)}];

//# sourceMappingURL=src_app_%28app%29_chat_page_tsx_280623e3._.js.map