(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,60754,e=>{"use strict";var t=e.i(43476);let a=function(){for(var e,t,a=0,r="",s=arguments.length;a<s;a++)(e=arguments[a])&&(t=function e(t){var a,r,s="";if("string"==typeof t||"number"==typeof t)s+=t;else if("object"==typeof t)if(Array.isArray(t)){var n=t.length;for(a=0;a<n;a++)t[a]&&(r=e(t[a]))&&(s&&(s+=" "),s+=r)}else for(r in t)t[r]&&(s&&(s+=" "),s+=r);return s}(e))&&(r&&(r+=" "),r+=t);return r};var r=e.i(71645),s=e.i(17255),n=e.i(57688);function l(){let e=!function(e=768){let[t,a]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{let t=window.matchMedia(`(max-width: ${e}px)`),r=()=>a(t.matches);return r(),t.addEventListener("change",r),()=>t.removeEventListener("change",r)},[e]),t}(768)?"/assets/fortress-bg-desktop.webp":"/assets/fortress-bg-portrait.webp",[a,s]=(0,r.useState)(!0);return(0,r.useEffect)(()=>{let t=new window.Image;t.src=e,t.onload=()=>s(!0),t.onerror=()=>s(!1)},[e]),(0,t.jsxs)("div",{"aria-hidden":!0,className:"pointer-events-none fixed inset-0 -z-10 overflow-hidden",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-[radial-gradient(60%_60%_at_50%_20%,#87a7c766_0%,#0b122099_60%,transparent_100%)]"}),(0,t.jsx)("div",{className:"absolute inset-0 opacity-30 bg-[url('/assets/starfield.png')] bg-repeat"}),a&&(0,t.jsxs)("div",{className:"absolute inset-0",children:[(0,t.jsx)(n.default,{src:e,alt:"",fill:!0,priority:!0,className:"object-cover opacity-90 select-none",sizes:"100vw"}),(0,t.jsx)("div",{className:"absolute inset-0 bg-linear-to-t from-slate-900/80 via-transparent to-transparent"})]})]})}function i({tone:e="neutral"}){let a=(0,r.useMemo)(()=>{switch(e){case"calm":return"from-cyan-300/25 via-cyan-500/15 to-transparent";case"excited":return"from-amber-300/25 via-amber-500/15 to-transparent";case"reflective":return"from-sky-300/25 via-blue-400/15 to-transparent";case"stressed":return"from-violet-400/25 via-fuchsia-500/10 to-transparent";default:return"from-slate-300/20 via-slate-500/10 to-transparent"}},[e]);return(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("div",{className:`pointer-events-none absolute -inset-6 rounded-3xl bg-linear-to-br ${a}`,"aria-hidden":"true"}),(0,t.jsx)("div",{className:"relative"})]})}function o(){let{status:e}=(0,s.useSession)(),n="authenticated"===e,[o,c]=(0,r.useState)([]),[d,m]=(0,r.useState)(""),[u,x]=(0,r.useState)(!1),[h,b]=(0,r.useState)("neutral"),[f,p]=(0,r.useState)(null),g=(0,r.useRef)(null),y=(0,r.useRef)(null);async function v(e){try{let t=await fetch("/api/pulse",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:e})});if(!t.ok)return b("neutral");let a=await t.json();a?.tone&&b(a.tone)}catch{b("neutral")}}async function w(){let e=d.trim();if(!e||u)return;if(e.length>2e3)return void p("Message is too long (max 2000 characters).");let t=o.filter(e=>"user"===e.role).length;if(!n&&t>=5)return void c(e=>[...e,{role:"assistant",content:"Limit reached (5 chats). Create an account or sign in to unlock full access, memory, and the full Fortress experience."}]);y.current?.abort();let a=new AbortController;y.current=a;let r={role:"user",content:e};c(e=>[...e,r,{role:"assistant",content:""}]),m(""),p(null),x(!0),v(e);try{let e=await fetch("/api/prime",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:[...o,r]}),signal:a.signal});if(!e.ok||!e.body)throw Error(`Prime endpoint ${e.status}`);let t=e.body.getReader(),s=new TextDecoder,n="",l=0,i=async()=>{try{for(;;){let{value:e,done:a}=await t.read();if(a)break;n+=s.decode(e,{stream:!0}),l||(l=requestAnimationFrame(()=>{c(e=>{let t=[...e],a=t.length-1;return a>=0&&"assistant"===t[a].role&&(t[a]={role:"assistant",content:n}),t}),l=0}))}}finally{l&&cancelAnimationFrame(l)}};await i(),c(e=>{let t=[...e],a=t.length-1;return a>=0&&"assistant"===t[a].role&&(t[a]={role:"assistant",content:n||"…"}),t}),v(n)}catch(e){if(e?.name==="AbortError")return;c(e=>[...e.slice(0,-1),{role:"assistant",content:"I hit a snag reaching the Prime endpoint. Try again in a moment, or check your connection."}]),p(e?.message??"Request failed.")}finally{x(!1),y.current=null}}(0,r.useEffect)(()=>{0===o.length&&c([{role:"assistant",content:"Welcome to the Fortress of Prime — a calm, sovereign space for clarity and growth. When you're ready, share what’s on your mind and I’ll meet you there."}])},[o.length]),(0,r.useEffect)(()=>{let e=g.current;if(!e)return;let t=requestAnimationFrame(()=>e.scrollTo({top:e.scrollHeight,behavior:"smooth"}));return()=>cancelAnimationFrame(t)},[o,u]);let j=!n&&o.filter(e=>"user"===e.role).length>=5;return(0,t.jsxs)("main",{className:"relative min-h-svh pt-24 md:pt-28 bg-slate-50 dark:bg-slate-950",children:[(0,t.jsx)(l,{}),"authenticated"!==e&&(0,t.jsx)("div",{className:"mx-auto w-full max-w-3xl px-4",children:(0,t.jsxs)("div",{className:"rounded-2xl border border-slate-200 dark:border-slate-800 bg-white/80 dark:bg-black/80 backdrop-blur p-4 text-sm text-slate-700 dark:text-slate-300",children:[(0,t.jsx)("span",{className:"mr-2",children:"Warning"}),"Limited to ",(0,t.jsx)("strong",{children:"5 chats"}),"."," ",(0,t.jsx)("span",{className:"opacity-90",children:"Create an account or sign in to access full features."}),(0,t.jsx)("button",{onClick:()=>(0,s.signIn)(),className:"ml-3 rounded-lg bg-cyan-600 px-3 py-1 text-white hover:bg-cyan-500",children:"Sign in"})]})}),!n&&o.length>0&&!j&&(0,t.jsx)("div",{className:"mx-auto max-w-3xl px-4 mb-4",children:(0,t.jsxs)("div",{className:"rounded-xl border border-cyan-500/30 bg-cyan-500/10 p-4 text-center",children:[(0,t.jsxs)("p",{className:"text-cyan-900 dark:text-cyan-200 text-sm",children:["Sign in to ",(0,t.jsx)("strong",{children:"save this conversation"})," and continue with Prime anytime."]}),(0,t.jsx)("button",{onClick:()=>(0,s.signIn)(),className:"mt-2 text-xs underline text-cyan-700 dark:text-cyan-300 hover:text-cyan-900",children:"Sign in now"})]})}),n&&o.length>0&&(0,t.jsx)("div",{className:"mx-auto max-w-3xl px-4 mb-4",children:(0,t.jsxs)("div",{className:"flex items-center justify-center gap-2 text-emerald-600 dark:text-emerald-400 text-sm font-medium",children:[(0,t.jsx)("span",{className:"w-2 h-2 bg-emerald-500 rounded-full animate-pulse"}),"Prime remembers you. The light within your Tree is glowing brighter every day."]})}),(0,t.jsxs)("div",{ref:g,className:"mx-auto h-[calc(100svh-220px)] w-full max-w-3xl overflow-y-auto px-4 pb-40 md:pb-48 scrollbar-thin",children:[(0,t.jsx)("div",{className:"mb-6 text-center text-[11px] tracking-widest text-slate-700 dark:text-slate-200/70 uppercase",children:"Within these walls — Truth & Light always win."}),(0,t.jsx)("div",{className:"space-y-3",children:o.map((e,r)=>{let s="user"===e.role,n="assistant"===e.role;return(0,t.jsxs)("div",{className:a("max-w-xs rounded-2xl px-4 py-3 border",s?"mr-auto bg-slate-100 dark:bg-slate-800 text-slate-900 dark:text-slate-100 border-slate-200 dark:border-slate-700":"ml-auto bg-cyan-500/20 dark:bg-cyan-600/20 text-cyan-700 dark:text-cyan-300 border-cyan-500/30 dark:border-cyan-600/30"),"aria-live":r===o.length-1&&n?"polite":void 0,children:[(0,t.jsx)(i,{tone:h}),(0,t.jsx)("div",{className:"relative whitespace-pre-wrap",children:e.content})]},r)})}),u&&(0,t.jsx)("div",{className:"mr-auto max-w-[85%] rounded-2xl border border-slate-200 dark:border-slate-800 bg-white/60 dark:bg-black/60 px-5 py-3 text-slate-600 dark:text-slate-400 backdrop-blur animate-pulse",children:"Prime is focusing…"}),f&&!u&&(0,t.jsx)("div",{className:"mr-auto max-w-[85%] rounded-2xl border border-rose-400/30 bg-rose-500/10 px-5 py-3 text-sm text-rose-700 dark:text-rose-300",children:f}),j&&(0,t.jsx)("div",{className:"mx-auto max-w-3xl px-4 mb-6",children:(0,t.jsxs)("div",{className:"rounded-2xl border border-amber-500/30 bg-linear-to-r from-amber-500/10 to-orange-500/10 p-5 text-center",children:[(0,t.jsx)("p",{className:"text-amber-900 dark:text-amber-200 font-semibold mb-3",children:"You've reached the guest limit (5 messages)."}),(0,t.jsxs)("p",{className:"text-sm text-amber-800 dark:text-amber-300 mb-4",children:["Unlock"," ",(0,t.jsx)("strong",{children:"unlimited chat, memory, and your Tree of Life"})," ","with SuperGrok."]}),(0,t.jsx)("button",{onClick:()=>(0,s.signIn)(),className:"rounded-xl bg-linear-to-r from-emerald-600 to-cyan-600 px-6 py-3 text-white font-bold hover:from-emerald-700 hover:to-cyan-700 transition-all shadow-lg",children:"Upgrade Now — $9/mo"})]})})]}),(0,t.jsx)("div",{className:"fixed inset-x-0 bottom-0 z-10",children:(0,t.jsxs)("div",{className:"mx-auto w-full max-w-3xl px-4 pb-5",children:[(0,t.jsxs)("div",{className:"relative rounded-2xl border border-slate-200 dark:border-slate-800 bg-white/80 dark:bg-black/80 backdrop-blur p-3",children:[(0,t.jsx)(i,{tone:h}),(0,t.jsx)("textarea",{value:d,onChange:e=>m(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),w())},placeholder:"Speak to Prime within the safety of the Fortress…",className:"min-h-[60px] w-full resize-none rounded-xl bg-white/70 dark:bg-black/70 p-3 text-slate-900 dark:text-slate-100 placeholder:text-slate-500 dark:placeholder:text-slate-400 focus:outline-none focus-visible:outline-2 focus-visible:outline-cyan-500 focus-visible:outline-offset-2"}),(0,t.jsx)("div",{className:"mt-2 flex items-center justify-end gap-2",children:(0,t.jsx)("button",{onClick:w,disabled:u||j,className:"rounded-xl bg-cyan-600 dark:bg-cyan-700 px-5 py-2 text-sm font-medium text-white hover:bg-cyan-500 dark:hover:bg-cyan-600 transition-all",children:u?"Sending…":"Send to Prime"})})]}),(0,t.jsx)("div",{className:"mt-3 text-center text-[11px] text-slate-700 dark:text-slate-200/70",children:"“Prime is here to help you navigate safely. The world is full of deception and deepfakes — we don’t fall for any of it.”"})]})})]})}e.s(["default",()=>o],60754)}]);