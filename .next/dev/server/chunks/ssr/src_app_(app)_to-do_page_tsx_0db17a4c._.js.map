{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Dev/eol-prime-sandbox/src/app/%28app%29/to-do/page.tsx"],"sourcesContent":["// src/app/(app)/to-do/page.tsx\r\n\"use client\";\r\n\r\nimport useSWR from \"swr\";\r\nimport { useState } from \"react\";\r\nimport {\r\n  DndContext,\r\n  closestCenter,\r\n  KeyboardSensor,\r\n  PointerSensor,\r\n  useSensor,\r\n  useSensors,\r\n  DragEndEvent,\r\n} from \"@dnd-kit/core\";\r\nimport {\r\n  arrayMove,\r\n  SortableContext,\r\n  sortableKeyboardCoordinates,\r\n  verticalListSortingStrategy,\r\n} from \"@dnd-kit/sortable\";\r\nimport { useSortable } from \"@dnd-kit/sortable\";\r\nimport { CSS } from \"@dnd-kit/utilities\";\r\nimport { EOLButton } from \"@/components/EOLButton\";\r\nimport { Loader2, GripVertical, Trash2 } from \"lucide-react\";\r\n\r\nconst fetcher = (url: string) =>\r\n  fetch(url, { cache: \"no-store\" }).then((r) => r.json());\r\n\r\ntype ToDo = {\r\n  _id: string;\r\n  title: string;\r\n  done: boolean;\r\n  order?: number;\r\n  createdAt: string;\r\n};\r\n\r\nfunction SortableItem({\r\n  item,\r\n  onToggle,\r\n  onRemove,\r\n}: {\r\n  item: ToDo;\r\n  onToggle: () => void;\r\n  onRemove: () => void;\r\n}) {\r\n  const {\r\n    attributes,\r\n    listeners,\r\n    setNodeRef,\r\n    transform,\r\n    transition,\r\n    isDragging,\r\n  } = useSortable({ id: item._id });\r\n\r\n  const style = {\r\n    transform: CSS.Transform.toString(transform),\r\n    transition,\r\n    opacity: isDragging ? 0.5 : 1,\r\n  };\r\n\r\n  return (\r\n    <article\r\n      ref={setNodeRef}\r\n      style={style}\r\n      className={`eol-panel group flex items-center gap-3 p-4 transition-all ${\r\n        isDragging ? \"scale-105 shadow-2xl\" : \"hover:scale-[1.005]\"\r\n      }`}\r\n    >\r\n      <button\r\n        {...attributes}\r\n        {...listeners}\r\n        className=\"cursor-grab active:cursor-grabbing opacity-40 hover:opacity-80\"\r\n      >\r\n        <GripVertical className=\"w-5 h-5\" />\r\n      </button>\r\n\r\n      <input\r\n        type=\"checkbox\"\r\n        checked={item.done}\r\n        onChange={onToggle}\r\n        className=\"w-5 h-5 rounded border-cyan-500/50 text-cyan-600 focus:ring-cyan-500\"\r\n      />\r\n\r\n      <div\r\n        className={`flex-1 text-sm ${item.done ? \"line-through opacity-60\" : \"\"}`}\r\n      >\r\n        {item.title}\r\n      </div>\r\n\r\n      <button\r\n        onClick={onRemove}\r\n        className=\"opacity-0 group-hover:opacity-70 hover:opacity-100 transition\"\r\n      >\r\n        <Trash2 className=\"w-4 h-4 text-rose-400\" />\r\n      </button>\r\n    </article>\r\n  );\r\n}\r\n\r\nexport default function ToDoPage() {\r\n  const { data, mutate, isValidating } = useSWR<{ ok: true; items: ToDo[] }>(\r\n    \"/api/to-do\",\r\n    fetcher,\r\n    {\r\n      revalidateOnFocus: true,\r\n    }\r\n  );\r\n  const [title, setTitle] = useState(\"\");\r\n\r\n  const items = data?.items || [];\r\n\r\n  const sensors = useSensors(\r\n    useSensor(PointerSensor),\r\n    useSensor(KeyboardSensor, {\r\n      coordinateGetter: sortableKeyboardCoordinates,\r\n    })\r\n  );\r\n\r\n  async function addToDo(e: React.FormEvent) {\r\n    e.preventDefault();\r\n    if (!title.trim()) return;\r\n\r\n    const optimistic = {\r\n      _id: `temp-${Date.now()}`,\r\n      title: title.trim(),\r\n      done: false,\r\n      createdAt: new Date().toISOString(),\r\n    };\r\n\r\n    await mutate(\r\n      async (curr) => {\r\n        const res = await fetch(\"/api/to-do\", {\r\n          method: \"POST\",\r\n          headers: { \"Content-Type\": \"application/json\" },\r\n          body: JSON.stringify({ title: title.trim() }),\r\n        });\r\n        const json = await res.json();\r\n        if (!json.ok) throw new Error(json.error);\r\n\r\n        return {\r\n          ok: true,\r\n          items: [\r\n            json.item,\r\n            ...(curr?.items || []).filter((i) => !i._id.startsWith(\"temp\")),\r\n          ],\r\n        };\r\n      },\r\n      {\r\n        optimisticData: { ok: true, items: [optimistic, ...items] },\r\n        revalidate: false,\r\n      }\r\n    );\r\n\r\n    setTitle(\"\");\r\n  }\r\n\r\n  async function handleDragEnd(event: DragEndEvent) {\r\n    const { active, over } = event;\r\n\r\n    if (active.id !== over?.id) {\r\n      const oldIndex = items.findIndex((i) => i._id === active.id);\r\n      const newIndex = items.findIndex((i) => i._id === over?.id);\r\n\r\n      const newItems = arrayMove(items, oldIndex, newIndex);\r\n\r\n      // Optimistic UI\r\n      mutate({ ok: true, items: newItems }, false);\r\n\r\n      // Sync order to backend\r\n      await fetch(\"/api/to-do/reorder\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({\r\n          items: newItems.map((item, index) => ({\r\n            id: item._id,\r\n            order: index,\r\n          })),\r\n        }),\r\n      });\r\n    }\r\n  }\r\n\r\n  return (\r\n    <main className=\"mx-auto max-w-3xl px-4 py-8 space-y-8\">\r\n      <header className=\"text-center space-y-2\">\r\n        <h1 className=\"text-5xl font-bold bg-linear-to-r from-cyan-400 to-sky-600 bg-clip-text text-transparent\">\r\n          ToDo\r\n        </h1>\r\n        <p className=\"text-sm opacity-70\">Drag to reorder. Build momentum.</p>\r\n      </header>\r\n\r\n      <form onSubmit={addToDo} className=\"eol-panel flex gap-3 p-4\">\r\n        <input\r\n          value={title}\r\n          onChange={(e) => setTitle(e.target.value)}\r\n          placeholder=\"What needs to be done?\"\r\n          className=\"flex-1 rounded-xl border border-slate-700/20 bg-slate-900/30 dark:bg-slate-950/50 px-4 py-3 text-sm placeholder:opacity-60 focus:outline-none focus:ring-2 focus:ring-cyan-500/50\"\r\n        />\r\n        <EOLButton variant=\"primary\" disabled={!title.trim()}>\r\n          Add ToDo\r\n        </EOLButton>\r\n      </form>\r\n\r\n      <DndContext\r\n        sensors={sensors}\r\n        collisionDetection={closestCenter}\r\n        onDragEnd={handleDragEnd}\r\n      >\r\n        <SortableContext\r\n          items={items.map((i) => i._id)}\r\n          strategy={verticalListSortingStrategy}\r\n        >\r\n          <section className=\"space-y-3\">\r\n            {isValidating && !items.length && (\r\n              <div className=\"eol-panel p-8 text-center opacity-70\">\r\n                <Loader2 className=\"w-6 h-6 mx-auto animate-spin\" />\r\n                <p className=\"mt-2\">Loading your To-Doâ€¦</p>\r\n              </div>\r\n            )}\r\n\r\n            {!items.length && !isValidating && (\r\n              <div className=\"eol-panel p-8 text-center opacity-70\">\r\n                <p>No To-Do yet. Start building momentum!</p>\r\n              </div>\r\n            )}\r\n\r\n            {items.map((item) => (\r\n              <SortableItem\r\n                key={item._id}\r\n                item={item}\r\n                onToggle={() =>\r\n                  mutate(\r\n                    {\r\n                      ok: true,\r\n                      items: items.map((i) =>\r\n                        i._id === item._id ? { ...i, done: !i.done } : i\r\n                      ),\r\n                    },\r\n                    false\r\n                  )\r\n                }\r\n                onRemove={() =>\r\n                  mutate(\r\n                    {\r\n                      ok: true,\r\n                      items: items.filter((i) => i._id !== item._id),\r\n                    },\r\n                    false\r\n                  )\r\n                }\r\n              />\r\n            ))}\r\n          </section>\r\n        </SortableContext>\r\n      </DndContext>\r\n    </main>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}